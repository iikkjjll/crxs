function aiparser(e){if(top==self){var t=0;if(location.href.match("traveldetail.fliggy.com/item")){chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]});var n=document.querySelectorAll(".item-gallery-thumb img"),a=document.querySelectorAll("#J_Desc img"),r=1;n.forEach(function(e,t){l({src:e.src,alt:"主图-"+s(r++,2),group:"主图",groupIndex:0})});var i=1;[].forEach(function(e,t){var n=e.style.backgroundImage.match(/(\/\/.*)"/);n&&l({src:n=n=location.protocol+n[1],group:"SKU图片",groupIndex:2,alt:"SKU-"+s(i++,2)+"-"+$(e).parent().attr("title")})});var o=1;a.forEach(function(e,t){var n=e.dataset.ksLazyload||e.src;n.match("img-tmdetail.alicdn.com/tps/i3/T1BYd_XwFcXXb9RTPq-90-90.png")||n.match("spaceball.gif")||l({alt:"详情-"+s(o++,2),src:n,group:"详情",groupIndex:3})});var c=document.querySelector(".item-video video");c&&(new VItem({src:c.currentSrc,group:"视频",groupIndex:1},t++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:_tabInfo.id,item:e})}),l({alt:"视频封面",src:c.poster,group:"视频",groupIndex:1}))}else document.querySelectorAll("img").forEach(function(e){l({src:e.src})})}function s(e,t){return(Array(t).join(0)+e).slice(-t)}function l(e){new ParsedPItem(e,t++,_tabInfo,function(e){e.width>300&&chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})}}window.aiparser=aiparser,function(){var e=0,t=0,n=setInterval(function(){t>20&&clearInterval(n),t++,$(".item-desc-tabview-list").length>0&&($(`<li class="item-desc-tabview-item" style="cursor: default;">\n                <button id="ftk-review-download-btn" style="cursor: pointer;">\n                    <img style="width:16px;vertical-align:middle;margin-right:4px;" src="${chrome.extension.getURL("/icon-small.png")}"/>\n                    <span>下载</span>\n                </button>\n                <span>第</span>\n                <input id="fatkun-review-page-input" type="number" value="1" style="width: 4em"/>\n                <span>页评论图片</span>\n            </li>`).appendTo(".item-desc-tabview-list").find("button").click(function(){var t=document.getElementById("fatkun-review-page-input").value,n=location.href.match("\\bid=(\\d+)")[1];chrome.runtime.sendMessage({cmd:"OPEN-OUTPUT",type:"tb-review"},function(){setTimeout(function(){fetch(`https://traveldetail.fliggy.com/async/queryRateList.do?id=${n}&tagId=:5&pageNo=${t}&sort=0&pageSize=20`).then(e=>e.json()).then(n=>{n.success?n.module.rateList.rateCellList.forEach(n=>{n.picList.forEach((a,r)=>{new ParsedPItem({src:a,alt:`${n.rateId}-${r+1}`,group:`page-${t}`},e++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_IMG",type:"tb-review",tabId:_tabInfo.id,item:e}),parse()})})}):n.url&&n.url.match("login.taobao.com")&&alert("请登录后再下载")})},2e3)})}),clearInterval(n))},500)}();