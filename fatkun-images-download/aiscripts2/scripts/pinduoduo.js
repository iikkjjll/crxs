function aiparser(t){if(top==self){var o=0;if(location.href.match("goods\\d?.html|goods.html"))try{var r=document.createElement("script");r.innerText="localStorage.fatkun_rawData = JSON.stringify(window.rawData);",document.body.appendChild(r);var e=JSON.parse(localStorage.fatkun_rawData).store.initDataObj.goods,a=1;e.topGallery.forEach(function(t){var o=t.url||t;o.match("^http")||(o=location.protocol+o),u({src:o,group:"主图",alt:"主图-"+d(a++,2),groupIndex:0})}),e.videoGallery.forEach(function(r){var e=r.videoUrl;e.match("^http")||(e=location.protocol+e),new VItem({src:e,group:"视频",groupIndex:1},o++,t,function(o){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:t.id,item:o})})});var i=1;e.skus.forEach(function(t){var o=t.thumbUrl;o.match("^http")||(o=location.protocol+o),u({src:o,alt:"SKU-"+d(i++,2)+"-"+(t.specs||[]).map(t=>t.spec_value).join("-"),group:"SKU图片",groupIndex:2})});var n=1;e.detailGallery.forEach(function(t){var o=t.url;o.match("^http")||(o=location.protocol+o),u({src:o,alt:"详情-"+d(n++,2),group:"详情",groupIndex:3})})}catch(r){var c=document.cookie.match("pdd_user_id=(\\d+)")[1],s=document.cookie.match("PDDAccessToken=(.*?)(;|$)")[1],p={};location.search.substr(1).split("&").forEach(t=>{var o=t.split("=");p[o[0]]=o[1]}),fetch(`https://mobile.yangkeduo.com/proxy/api/api/oak/integration/render?pdduid=${c}&is_back=1`,{method:"POST",headers:{accept:"application/json, text/plain, */*","content-type":"application/json;charset=UTF-8",accesstoken:s},body:JSON.stringify({client_time:Date.now(),extend_map:{},goods_id:parseInt(p.goods_id),hostname:"mobile.yangkeduo.com",page_from:parseInt(p.page_from),page_version:7,refer_page_sn:p.refer_page_sn})}).then(t=>t.json()).then(r=>{var e=r.goods.gallery,a=e.filter(t=>1==t.type);a.sort((t,o)=>t.priority-o.priority);var i=e.filter(t=>2==t.type);i.sort((t,o)=>t.priority-o.priority);var n=e.filter(t=>6==t.type),c=e.filter(t=>-1==[1,2,6].indexOf(t.type)),s=1;a.forEach(function(t){u({src:t.url,width:t.width,height:t.height,group:"主图",alt:"主图-"+d(s++,2),groupIndex:0})});var p=1;i.forEach(function(t){u({src:t.url,width:t.width,height:t.height,group:"详情",alt:"详情-"+d(p++,2),groupIndex:3})});r.sku&&r.sku.sort((t,o)=>t.priority-o.priority).forEach(t=>{u({src:t.thumb_url+"?"+Date.now(),alt:"SKU-"+t.specs.map(t=>t.spec_value).join("-"),group:"SKU",groupIndex:1})}),n.forEach(function(r){new VItem({src:r.url,group:"视频",groupIndex:2},o++,t,function(o){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:t.id,item:o})})});var l=1;c.forEach(function(r){r.video_url&&new VItem({src:r.video_url,group:"其他",groupIndex:4},o++,t,function(o){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:t.id,item:o})}),r.url&&u({src:r.url,width:r.width,height:r.height,group:"其他",alt:"其他-"+d(l++,2),groupIndex:2})})})}else if(location.href.match("goods_comments.html")){var l=document.querySelectorAll("#goods-comments-list .oimage");l.length>0&&l.forEach(function(t){var o=t.style.backgroundImage.match('url\\("(.*)"\\)');o&&((o=o[1].replace(/\?imageMogr2\/thumbnail.*/,"")).match(/^http/)||(o=location.protocol+o),u({src:o}))})}}function d(t,o){return(Array(o).join(0)+t).slice(-o)}function u(r){new ParsedPItem(r,o++,t,function(o){chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:t.id,item:o})})}}window.aiparser=aiparser;