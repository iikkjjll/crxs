function getInfoFromBlob(t,e){t.contentType?utils.getInfoFromBlob(t,function(i){for(var n in i.data)t[n]=i.data[n];e(i)}):e({success:!1,msg:"Content-Type-Error"})}function getWHAndJpgPngDataUrl(t,e){var i=new Image;i.onload=function(){if(t.width=i.naturalWidth,t.height=i.naturalHeight,_config.autoConvertWebp&&"webp"==t.ext){var n=getJpgPngDataUrlFromWebp(i,t.bigUrl);t.jpgPngDataUrl=n.jpgPngDataUrl,t.ext=n.ext||t.ext}e({success:!0})},i.src=t.bigUrl}function getInfoOfImgDirect(t,e,i){try{t.bigUrl.match("^data:image")}catch(t){}t.bigUrl.match("^data:image")?(t.ext=t.bigUrl.match("^data:image/(.+?);")[1],getWHAndJpgPngDataUrl(t,i)):_config.autoConvertWebp||_config.needBlobDomains.indexOf(t.site)>=0?utils.getBlobAndContentType(t.bigUrl,function(e){e.success?(t.blobUrl=e.data.blobUrl,t.contentType=e.data.contentType,getInfoFromBlob(t,function(e){-1==_config.needBlobDomains.indexOf(t.site)&&(window.URL.revokeObjectURL(t.blobUrl),delete t.blobUrl),i(e)})):i(e)}):getWHAndJpgPngDataUrl(t,i)}function getInfoOfImgInDirect(t,e,i){try{t.bigUrl.match("^data:image")}catch(t){}t.bigUrl.match("^data:image")?(t.ext=t.bigUrl.match("^data:image/(.+?);")[1],getWHAndJpgPngDataUrl(t,i)):chrome.tabs.sendMessage(e.id,{cmd:"GET_BLOB",url:t.bigUrl},{frameId:t.frameId},function(n){n.success?(t.blobUrl=n.data.blobUrl,t.contentType=n.data.contentType,chrome.tabs.sendMessage(e.id,{cmd:"GET_INFO_FROM_BLOB",item:t},function(e){if(e){for(var n in e.data)t[n]=e.data[n];-1==_config.needBlobDomains.indexOf(t.site)&&(window.URL.revokeObjectURL(t.blobUrl),delete t.blobUrl)}i(e)})):i(n)})}function getInfoOfImg(t,e,i){try{t.bigUrl.match("^data:image")}catch(t){}t.bigUrl.match("^data:image")?(t.ext=t.bigUrl.match("^data:image/(.+?);")[1],getWHAndJpgPngDataUrl(t,i)):chrome.tabs&&_config.needBlobDomains.indexOf(t.site)>=0?chrome.tabs.sendMessage(e.id,{cmd:"GET_BLOB",url:t.bigUrl},function(n){n.success?(t.blobUrl=n.data.blobUrl,t.contentType=n.data.contentType,chrome.tabs.sendMessage(e.id,{cmd:"GET_INFO_FROM_BLOB",item:t},function(e){if(e){for(var n in e.data)t[n]=e.data[n];-1==_config.needBlobDomains.indexOf(t.site)&&(window.URL.revokeObjectURL(t.blobUrl),delete t.blobUrl)}i(e)})):i(n)}):_config.autoConvertWebp?utils.getBlobAndContentType(t.bigUrl,function(e){e.success?(t.blobUrl=e.data.blobUrl,t.contentType=e.data.contentType,getInfoFromBlob(t,function(e){-1==_config.needBlobDomains.indexOf(t.site)&&(window.URL.revokeObjectURL(t.blobUrl),delete t.blobUrl),i(e)})):i(e)}):getWHAndJpgPngDataUrl(t,i)}function CommonItem(t,e,i,n){this.originalUrl=t,this.type=n,this.tabIndex=e.index,this.tabId=e.id,this.frameId=i,this.ref=e.url,this.site=utils.getDomainFromUrl(e.url),this.docTitle=e.title}function InitPItem(t,e,i){CommonItem.call(this,t.src,e,i,"IMG"),this.alt=t.alt}function ParsedPItem(t,e,i,n,o){"function"==typeof n&&(o=n,n=0);var a=this;this.index=e,InitPItem.call(this,t,i,n),this.bigUrlIsValid=!0,this.bigUrl=bigImgParser.parse(this.originalUrl),this.smallUrl=t.smallUrl||this.bigUrl,this.group=t.group||"",this.groupIndex=void 0===t.groupIndex?-1:t.groupIndex,t.width&&t.height?(this.width=t.width,this.height=t.height,o(this)):chrome.tabs&&_config.needBlobDomains.indexOf(utils.getDomainFromUrl(i.url))>=0?getInfoOfImgInDirect(this,i,function(t){t.success?o(a):(a.bigUrlIsValid=!1,o(a))}):getInfoOfImgDirect(this,i,function(t){t.success?o(a):(a.bigUrlIsValid=!1,o(a))})}function VItem(t,e,i,n,o){"function"==typeof n&&(o=n,n=0),CommonItem.call(this,t.src,i,n,"VIDEO"),this.group=t.group||"",this.groupIndex=void 0===t.groupIndex?-1:t.groupIndex,this.index=e,this.width=0,this.height=0,this.alt=t.alt,o(this)}