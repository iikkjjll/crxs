function ScriptItem(t){for(var n in this.latest=null,this.latestVersion="",this.updated=!1,t)this[n]=t[n];t.funlist?this.funlist=t.funlist.map(t=>{var n=_.find(this.funlist,{funId:t.funId});return t.enabled=n?n.enabled:t.defaultEnabled,t}):this.funlist=[],void 0===this.status&&(this.status="uninstalled")}var aiscripts=function(){var t=gConfig.staticServer+"/aiscripts2/scripts.json",n=[];return{init_:function(t){$.ajax({url:"/aiscripts2/scripts/scripts.json",dataType:"json",success:function(n){Promise.all(n.map(t=>fetch(t.url.replace("http://fatkun.static.8fenxiang.com/aiscripts2","/aiscripts2/scripts")).then(t=>t.text()).then(n=>(t.text=n,t.status="enabled",new ScriptItem(t))))).then(n=>{chrome.storage.local.set({aiscripts2:n}),t&&t(n)})}})},init:function(t){n=[],chrome.storage.local.get("aiscripts2",function(e){temp=e.aiscripts2||[];for(var i=0;i<temp.length;i++)n.push(new ScriptItem(temp[i]));t(n)})},getAll:function(){return n},getById:function(t){return _.find(n,{id:t})},getByUrl:function(t){for(var e=0;e<n.length;e++)if(t.match(n[e].reg))return n[e];return null},checkUpdate:function(e,i){fetch(t+"?_="+Date.now()).then(function(t){return t.json()}).then(function(t){var s=_.find(n,{id:e}),r=_.find(t,{id:e});i({needUpdate:utils.compareVersion(s.version,r.version)<0,newItem:r})})},update:function(t,e){var i=this;fetch(t.url+"?_="+Date.now()).then(function(t){return t.text()}).then(function(s){var r=i.getById(t.id);for(var c in t)"funlist"==c?(r.funlist&&t[c].forEach(function(t){var n=_.find(r.funlist,{funId:t.funId});n&&(t.enabled=!!n.enabled)}),r[c]=t[c]):r[c]=t[c];r.text=s,r.latest=null,r.latestVersion="",chrome.storage.local.set({aiscripts2:n},function(){e&&e({success:!0})})})},install:function(t,e){var i=_.find(n,{id:t});fetch(i.url+"?_="+Date.now()).then(function(t){return t.text()}).then(function(t){i.text=t,chrome.storage.local.set({aiscripts2:n},function(){e(i)})})},remove:function(t,e){var i=_.find(n,{id:t});delete i.text,chrome.storage.local.set({aiscripts2:n},function(){e(i)})},enable:function(t,e){var i=_.find(n,{id:t});i.text?(i.status="enabled",chrome.storage.local.set({aiscripts2:n},function(){e&&e({success:!0})})):this.install(t,function(){i.status="enabled",chrome.storage.local.set({aiscripts2:n},function(){e&&e({success:!0})})})},disable:function(t,e){var i=_.find(n,{id:t});i.status="disabled",chrome.storage.local.set({aiscripts2:n},function(){e&&e(i)})},enableFun:function(t,e,i){_.find(n,{id:t}).funlist.filter(function(t){return t.funId==e})[0].enabled=!0,chrome.storage.local.set({aiscripts2:n},function(){i&&i({success:!0})})},disableFun:function(t,e,i){_.find(n,{id:t}).funlist.filter(function(t){return t.funId==e})[0].enabled=!1,chrome.storage.local.set({aiscripts2:n},function(){i&&i({success:!0})})}}}();