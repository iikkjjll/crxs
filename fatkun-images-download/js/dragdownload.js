function addDragDownload(){var t=0;dragDownloadAdded=!0;var n,a,e,o,r,i,s=1;function c(n){top!=self||r||0!=$("#yuntu-drop-panel").length||0!=$("#fatkun-drop-panel").length||chrome.storage.local.get("dropPanelHtml",function(a){var e=a.dropPanelHtml;r=$(e).appendTo(document.body),navigator.language.match("^zh")&&(r.find(".fatkun-title").text("拖拽到此处"),r.find(".fatkun-desc").text("图片将完成下载")),r.on("dragleave",function(){return 2===s?r.css({opacity:.8}):r.css({opacity:.8,transform:"scale(1)"}),!1}).on("dragover",function(){return 2===s?r.css({opacity:1}):r.css({opacity:1,transform:"scale(1.05)"}),!1}).on("drop",function(n){if(location.href.match("instagram.com"))parsers.instagram(i,function(n){imageManager.imgList=[],imageManager.addImg(ImageType.IMG,n,0,0),new ParsedPItem({src:n},t,_tabInfo,function(t){parsedPItem.showIndex=parsedPItem.index,chrome.runtime.sendMessage({cmd:"DOWNLOAD_BY_DRAG",item:parsedPItem})}),t++,r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})});else{var a=n.originalEvent.dataTransfer.getData("fatkun");n.originalEvent.dataTransfer.getData("type");new ParsedPItem({src:a},t,_tabInfo,function(t){t.showIndex=t.index,chrome.runtime.sendMessage({cmd:"DOWNLOAD_BY_DRAG",item:t})}),t++,r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})}return!1}),r.find("#fatkun-drop-panel-close-btn").click(function(){r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})}),n()})}function d(t){if(2===s)r.css({bottom:"0",opacity:.9});else{var n=e,a=o;if(0===e&&0===o)return;"Top"===t.orientation?(n-=120,(a=a-240-80)<0&&(a=0),n+240>window.innerWidth&&(n=window.innerWidth-240),r.css({opacity:.8,left:n,top:a,transform:"scale(1)"})):"Bottom"===t.orientation?(n-=120,(a+=80)<0&&(a=0),n+240>window.innerWidth&&(n=window.innerWidth-240),r.css({opacity:.8,left:n,top:a,transform:"scale(1)"})):"Right"===t.orientation?(n+=80,(a-=120)<0&&(a=0),n+240>window.innerWidth&&(n=window.innerWidth-240),r.css({opacity:.8,left:n,top:a,transform:"scale(1)"})):(n=n-80-240,(a-=120)<0&&(a=0),n<0&&(n=0),r.css({opacity:.8,top:a,left:n,transform:"scale(1)"}))}}window.jQuery("body").on("mousemove",function(t){t.originalEvent.pageX,t.originalEvent.pageY,n=t.originalEvent.clientX,a=t.originalEvent.clientY}),_config.dragDownload&&c(function(t){}),chrome.storage.onChanged.addListener(function(t){var n=t.app_config;n&&(n.newValue.dragDownload?c(function(t){}):(window.jQuery("#fatkun-drop-panel").remove(),r=null))}),window.jQuery("body").on("mousedown","video",function(t){$(this).attr("draggable","true")}),window.jQuery("body").on("dragstart","img, a, video",function(t){var r;if(_config.dragDownload&&(i=t.target,"IMG"==t.target.tagName?r=t.target.src:"A"==t.target.tagName?(location.href.match("facebook.com")&&(r=$(t.target).attr("data-ploi")),r||(r=(r=$(t.target).find("img")[0])?r.src:"")):"VIDEO"==t.target.tagName&&(r=t.target.currentSrc),r)){var s=t.dataTransfer||t.originalEvent.dataTransfer;s.setData("fatkun",r),s.setData("type",t.target.tagName),s.setData("text/plain","fatkun"),e=t.originalEvent.clientX,o=t.originalEvent.clientY,setTimeout(function(){d(Math.abs(e-n)>Math.abs(o-a)?e<=n?{orientation:"Right"}:{orientation:"Left"}:o<=a?{orientation:"Bottom"}:{orientation:"Top"})},150)}}),window.addEventListener("dragend",function(){r&&r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})})}